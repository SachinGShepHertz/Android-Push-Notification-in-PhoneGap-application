App42-Android-Push-Sample-Using-PhoneGap
==========================


# About Application

1. This application shows how can we integrate Push Notification using App42 API in Phone-Gap Android application.
2. How we can send Push Notification using App42 Java-Script Push Notification API.


# Running Sample

This is a sample Android app is made by using App42 back-end platform. It uses Push Notification API of App42 platform.
Here are the few easy steps to run this sample app.

1. [Register] (https://apphq.shephertz.com/register) with App42 platform.
2. Create an app once, you are on Quick start page after registration.
3. If you are already registered, login to [AppHQ] (http://apphq.shephertz.com) console and create an app from App Manager Tab.
4. To use Push Notification service in your application open [link] (https://code.google.com/apis/console/b/0/?noredirect&pli=1) and create a new project here.
5. Click on services option in Google console and enable Google Cloud Messaging for Android service.
6. Click on API Access tab and create a new server key for your application with blank server information.
7. Go to [AppHQ] (http://apphq.shephertz.com) console and click on Push Notification and select Android Settings in Settings option.
8. Select your app and copy server key that is generated by using Google API console in step 6, and submit it.
9. Download the project from [here] (https://github.com/VishnuGShephertz/Android-Push-Notification-in-PhoneGap-application/archive/master.zip) and import it in the eclipse.
10. Open index.html  file in assets/app42 of sample app and make following changes.

```
A. Replace api-Key and secret-Key that you have received in step 2 or 3 at line number 5q.
C. Replace your user-id by which you want to register your application for Push Notification at line number 52.
```

11.Open App42PhonegapPush.java file in sample app and make following changes.

```
A. Replace project-no with your Google Project Number at line number 28.
```
12.Build your android application and install on your android device.

__Test and verify Push Notification from AppHQ console__
 
```
A. After registering for Push Notification go to AppHQ console and click on Push Notification and select
  application after selecting User tab.
B. Select desired user from registered User-list and click on Send Message Button.
C. Send appropriate message to user by clicking Send Button.

```
# Design Details:
__Initializing App42API in Java-script to send Push Notication using HTML Application:__ To Send Push Notification using APP42 Java-Script API we have to initialize first using Api-Key and Secret-Key in HTML file.
 
```
  function intializeApp42API() {
            App42
                    .initialize(
                            '<YOUR API KEY>',
                            '<YOUR SECRET KEY>');
        };

```

__Registering on GCM for Push Notification in Android:__ To get Push Notification we have to register on GCM using Google Project Nocin App42PhonegapPush.java file.
 
```
  
            Util.registerWithApp42("<Your Google Project No>");

```



__Send Push Notification to User using Java-Script App42 API :__ If you want to send Push Notification message using App42 API , pass the userId and
message in below method .
 
```
	function sendPushToUser() {
            var msg = document.getElementById('msg').value;
            var username = document.getElementById('user').value;
            var push = new App42Push();
            push.sendPushMessageToUser(username, msg);
        }

```

__Send Push Notification to all users using Java-Script App42 API :__ If you want to send Push Notification message to all users using App42 API , pass message in below method .
 
```
	 function sendPushMessageToAll() {
			var push = new App42Push();
			var message = document.getElementById('msg').value;
			push.sendPushMessageToAll(message);
		}

```

__Customize Push Notification Message:__ You can also customize your Push Notification message by changing following code in GCMIntentService.java file accordingly.
 
```
       Notification notification = new NotificationCompat.Builder(context)
        .setContentTitle(title)
        .setContentText(message)
        .setContentIntent(intent)
        .setSmallIcon(android.R.drawable.menuitem_background)
        .setWhen(when)
        .setLargeIcon(bmp)
        .setLights(Color.YELLOW, 1, 2)
        .setAutoCancel(true)
        .build();
         notification.defaults |= Notification.DEFAULT_SOUND; 
         notification.defaults |= Notification.DEFAULT_VIBRATE;
         notificationManager.notify(0, notification);

```



__Calling Java-Script pushMessageAlert(msg) function from Android native code:__ Whenever Push Notification comes on device we have to render it on HTML page.

 
```
 	public void renderData(final String message) {
		try {
			Thread.sleep(5000);
			super.loadUrl("javascript:pushMessageAlert(\"" + message + "\")");
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
 	}


```

__Rendering Push Notification on HTML Page:__ Whenever Push Notification comes on device we have to render it on HTML page.Following function is called from Android native and render Push
Notification on Html Page.

```
    function callFromActivity(msg) {
			   alert(msg)
		  	document.getElementById("mytext").innerHTML = msg;
	 	}

```
__Calling Java-Script registerForPush(deviceId) function from Android native code:__ This function is used to store device Id on App41 to get Push Notifications.

```
 	public void registerForApp42Push(String deviceId) {
		try {
			Thread.sleep(5000);
			super.loadUrl("javascript:registerForPush(\"" + deviceId + "\")");
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	  }


```

__Store Device Token on App42:__ This function store device token on App42 using java-script API , called from Android native code.

```
   function registerForPush(deviceId) {
			var push = new App42Push();
			push.storeDeviceToken(App42.getLoggedInUser(),deviceId,'ANDROID');
		
		}

```



